<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Anomalia de Temperatura - Belém</title>
  <link rel="shortcut icon" href="../principal/imagens/logo.ico" type="image/x-icon">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2 style="text-align: center;">Mudança na temperatura do ar em Belém - PA (1970 - 2024)</h2>
  <div id="chart" style="width: 100%; height: 600px;"></div>

  <script>
    // Função para gerar a cor de cada barra com base na anomalia
    function getColor(value, min, max) {
      const colors = [
        '#08306b', '#08519c', '#2171b5', '#4292c6',
        '#6baed6', '#9ecae1', '#c6dbef', '#deebf7',
        '#fee0d2', '#fcbba1', '#fc9272', '#fb6a4a',
        '#ef3b2c', '#cb181d', '#a50f15', '#67000d'
      ];
      const idx = Math.floor((value - min) / (max - min) * (colors.length - 1));
      return colors[Math.max(0, Math.min(colors.length - 1, idx))];
    }

    fetch("ERA5_temperature_2m_annual_belem.csv")
      .then(response => response.text())
      .then(csv => {
        const rows = csv.trim().split("\n").slice(1);
        const years = [];
        const anomalies = [];

        for (const row of rows) {
          const [year, anomaly] = row.split(",");
          if (year && anomaly) {
            years.push(parseInt(year));
            anomalies.push(parseFloat(anomaly));
          }
        }

        const minVal = Math.min(...anomalies);
        const maxVal = Math.max(...anomalies);
        const colors = anomalies.map(a => getColor(a, minVal, maxVal));

        const trace = {
          x: years,
          y: Array(years.length).fill(1),
          type: 'bar',
          marker: { color: colors },
          hoverinfo: 'x+y'
        };

        const layout = {
          xaxis: {
            title: 'Ano',
            tickvals: years.filter(y => y % 10 === 0),
            tickangle: 0
          },
          yaxis: {
            visible: false,
            range: [0, 1]
          },
          showlegend: false,
          margin: { l: 40, r: 60, t: 20, b: 100 },
          annotations: [{
            xref: 'paper',
            yref: 'paper',
            x: 0,
            y: -0.25,
            showarrow: false,
            align: 'left',
            text: "Elaborado por: Cleber Assis dos Santos<br>Média da temperatura do ar entre os anos de 1971 e 2000 (26.4°C)",
            font: { size: 10, color: 'gray' }
          }],
          plot_bgcolor: 'white',
          paper_bgcolor: 'white'
        };

        Plotly.newPlot('chart', [trace], layout);
      });
  </script>
</body>
</html>
